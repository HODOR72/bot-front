"use strict";(self.webpackChunk_it_meteor_admin=self.webpackChunk_it_meteor_admin||[]).push([[779],{80779:function(e,n,t){t.r(n),t.d(n,{default:function(){return G}});var r=t(70885),a=t(20803),s=t(58561),i=t(53451),c=t(72791),o=t(59434),u=t(9440),l=t(15861),d=t(64687),p=t.n(d),f=t(92033),h=t(17449),x=f.Z.axiosBase;function m(e){return(0,l.Z)(p().mark((function n(){var t,r;return p().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(0,u.WI)((0,h.Av)()),n.prev=1,t=0,n.next=5,x.get("getUsers",{params:e});case 5:r=n.sent;case 6:if(!(0===r.data.length&&t<3)){n.next=13;break}return n.next=9,x.get("getUsers",{params:e});case 9:r=n.sent,t++,n.next=6;break;case 13:(0,u.WI)((0,h.bG)(r.data)),n.next=20;break;case 16:n.prev=16,n.t0=n.catch(1),(0,u.WI)((0,h.xT)(n.t0)),(0,u.WI)(m(e));case 20:case"end":return n.stop()}}),n,null,[[1,16]])})))}var v=t(42982),g=t(96015),Z=t(4565),b=t(17205),k=t(64802),j=t(34045),w=t(80184),y=function(e){var n=e.actionsList,t=function(e){var n=j.P6.book_new(),t=[["\u0414\u0430\u0442\u0430","ID","\u0417\u0430\u043a\u0430\u0437","\u0422\u0435\u043b\u0435\u0444\u043e\u043d","ID \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f"]].concat((0,v.Z)(e.map((function(e){return[r(e.date),e.id,e.order,e.phone,e.userId]})))),a=j.P6.aoa_to_sheet(t);return j.P6.book_append_sheet(n,a,"Sheet 1"),n},r=function(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})};return(0,w.jsxs)(g.Z,{sx:{display:"flex",gap:2,mb:4},children:[(0,w.jsx)(Z.Z,{variant:"h3",component:"h1",paragraph:!0,children:"\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432"}),(0,w.jsx)(b.Z,{size:"large",variant:"contained",onClick:function(){return function(e,n){var t=n(e),r=j.cW(t,{type:"array",bookType:"xlsx"}),a=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,k.saveAs)(a,"historyActions.xlsx")}(n,t)},children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c"})]})},I=function(e){var n=e.userList,t=function(e){var n=j.P6.book_new();console.log(e);var t=[["\u0418\u043c\u044f","\u0424\u0430\u043c\u0438\u043b\u0438\u044f","\u041d\u0438\u043a\u043d\u0435\u0439\u043c","\u0422\u0435\u043b\u0435\u0444\u043e\u043d","ID \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f"]].concat((0,v.Z)(e.map((function(e){return[e.name,e.surname,e.nickname,e.phone,e.userId]})))),r=j.P6.aoa_to_sheet(t);return j.P6.book_append_sheet(n,r,"Sheet 1"),n};return(0,w.jsxs)(g.Z,{sx:{display:"flex",gap:2,mb:4},children:[(0,w.jsx)(Z.Z,{variant:"h3",component:"h1",paragraph:!0,children:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438"}),(0,w.jsx)(b.Z,{size:"large",variant:"contained",onClick:function(){return function(e,n){var t=n(e),r=j.cW(t,{type:"array",bookType:"xlsx"}),a=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,k.saveAs)(a,"usersList.xlsx")}(n,t)},children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c"})]})},W=t(60277),_=t(71747),L=t(88055),C=t(79365),P=t(54479),S=t(34420),A=t(63360),B=t(75017),D=t(38254),z=t(35702),M=t(54585),T=t(86951),F=t(46865),E=t(77483),J=f.Z.axiosBase;function R(e){return(0,l.Z)(p().mark((function n(){var t;return p().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,J.get("sendMessages?users=".concat(e.users.join(","),"&message=").concat(e.message));case 3:return t=n.sent,(0,u.WI)((0,E.mJ)(t.data.data)),n.abrupt("return",!0);case 8:n.prev=8,n.t0=n.catch(0),(0,u.WI)((0,E.xT)(n.t0));case 11:return n.abrupt("return",!1);case 12:case"end":return n.stop()}}),n,null,[[0,8]])})))}var U=function(e){var n,t=e.userList,a=(0,T.Ds)().enqueueSnackbar,s=(0,c.useState)(!1),i=(0,r.Z)(s,2),o=i[0],d=i[1],f=(0,c.useState)([]),h=(0,r.Z)(f,2),x=h[0],m=h[1],v=(0,c.useState)(""),k=(0,r.Z)(v,2),j=k[0],y=k[1],I=(0,c.useState)(1),E=(0,r.Z)(I,2),J=E[0],U=E[1],O=(0,c.useRef)(null),q=(0,c.useMemo)((function(){return(Array.isArray(t)?t:[]).filter((function(e){return function(e,n){return e.toLowerCase().indexOf(n.toLowerCase())>-1}(e.nickname,j)}))}),[t,j]),G=Math.ceil(q.length/8),K=8*(J-1),N=K+8;if(j.trim()){var V=q.length,H=Math.ceil(V/8);n=0===V?[]:V<=8?q:J===H?q.slice(K):q.slice(K,N)}else n=q.slice(K,N);var Q=function(){var e=(0,l.Z)(p().mark((function e(){var n,r,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=O.current.value,0!==x.length){e.next=3;break}return e.abrupt("return",a("\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439",{variant:"error"}));case 3:if(""!==n.trim()){e.next=5;break}return e.abrupt("return",a("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",{variant:"error"}));case 5:return r=x.map((function(e){var n=t.find((function(n){return n.nickname===e}));return n?n.userId:null})),s=r.filter((function(e){return null!==e})),m([]),e.next=10,(0,u.WI)(R({users:s,message:JSON.stringify(n)}));case 10:return n="",e.abrupt("return",a("\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e",{variant:"success"}));case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=(0,W.ZP)(_.Z)((function(e){var n=e.theme;return"\n    width: 320px;\n    font-family: IBM Plex Sans, sans-serif;\n    font-size: 0.875rem;\n    font-weight: 400;\n    line-height: 1.5;\n    padding: 12px;\n    border-radius: 12px 12px 0 12px;\n    border: 1px solid ".concat("dark"===n.palette.mode?"rgba(145, 158, 171, 0.32)":"#d0d7de",";\n    color: ").concat("dark"===n.palette.mode?"rgb(133, 133, 133)":"#000",";\n    background: ").concat("dark"===n.palette.mode?"#161C24":"#fff",";\n     &:focus-visible {\n      outline: 0;\n    }\n  ")}));return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(Z.Z,{variant:"h3",component:"h1",paragraph:!0,children:"\u0420\u0430\u0441\u0441\u044b\u043b\u043a\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439"}),(0,w.jsxs)(g.Z,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:4},children:[(0,w.jsxs)(L.Z,{fullWidth:!0,sx:{maxWidth:320,width:"100%"},children:[(0,w.jsx)(C.Z,{id:"search-select-label",children:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438"}),(0,w.jsxs)(P.Z,{MenuProps:{autoFocus:!1},labelId:"search-select-label",id:"search-select",value:x,label:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438",multiple:!0,input:(0,w.jsx)(S.Z,{label:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438"}),renderValue:function(e){return e.join(", ")},onChange:function(e){var n;return m(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value)},onClose:function(){return y("")},sx:{padding:.72},children:[(0,w.jsx)(A.Z,{sx:{marginBottom:2},children:(0,w.jsx)(b.Z,{size:"large",variant:"contained",sx:{width:"100%"},onClick:function(){d(!o),m(o?[]:t.map((function(e){return e.nickname})))},children:o?"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u044b\u0431\u043e\u0440 \u0432\u0441\u0435\u0445":"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435\u0445"})}),(0,w.jsx)(A.Z,{children:(0,w.jsx)(B.Z,{size:"small",autoFocus:!0,placeholder:"\u041f\u043e\u0438\u0441\u043a...",fullWidth:!0,InputProps:{startAdornment:(0,w.jsx)(D.Z,{position:"start",children:(0,w.jsx)(F.Z,{icon:"eva:search-fill",sx:{color:"text.disabled",width:20,height:20}})})},onChange:function(e){return y(e.target.value)},onKeyDown:function(e){"Escape"!==e.key&&e.stopPropagation()}})}),n.map((function(e,n){return(0,w.jsx)(z.Z,{value:e.nickname,children:e.nickname},n)})),(0,w.jsx)(g.Z,{sx:{marginTop:2,display:"flex",justifyContent:"center"},children:(0,w.jsx)(M.Z,{count:G,page:J,onChange:function(e,n){U(n)},variant:"outlined",shape:"rounded",color:"primary"})})]})]}),(0,w.jsx)(X,{id:"outlined-basic",ref:O,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",minRows:2,maxLength:4095,maxRows:10,style:{maxWidth:320,width:"100%"}}),(0,w.jsx)(b.Z,{size:"large",variant:"contained",onClick:Q,children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})]})]})},O=t(26649),q=f.Z.axiosBase;function G(){var e=(0,s.Z)().themeStretch,n=(0,c.useState)(!1),t=(0,r.Z)(n,2),d=t[0],f=t[1],h=(0,o.v9)((function(e){return e.user})),x=h.userList,v=h.userListParams,g=(0,o.v9)((function(e){return e.actions})),Z=g.actionsList,b=g.actionsListParams;return(0,c.useEffect)((function(){(0,u.WI)(m(v)).then((function(){f(!0)}))}),[u.WI,v]),(0,c.useEffect)((function(){var e;(0,u.WI)((e=b,(0,l.Z)(p().mark((function n(){var t;return p().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(0,u.WI)((0,O.Av)()),n.prev=1,n.next=4,q.get("getActions",{params:e});case 4:t=n.sent,console.log(t.data),(0,u.WI)((0,O.dJ)(t.data)),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(1),(0,u.WI)((0,O.xT)(n.t0));case 12:case"end":return n.stop()}}),n,null,[[1,9]])})))))}),[u.WI,b]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(i.Z,{title:"\u0413\u043b\u0430\u0432\u043d\u0430\u044f",children:(0,w.jsxs)(a.Z,{maxWidth:!e&&"xl",children:[d&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(U,{userList:x||[]}),(0,w.jsx)(I,{userList:x||[]})]}),(0,w.jsx)(y,{actionsList:Z||[]})]})})})}}}]);
//# sourceMappingURL=779.17c19916.chunk.js.map